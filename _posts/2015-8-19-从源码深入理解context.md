---
layout: post
author: mxn
titile: 从源码深入理解context
category: 技术博文
tag: android
---

## Context是什么

我们可以理解为“上下文”：它贯穿整个应用；
也可以理解成“运行环境”：它提供了一个应用运行所需要的信息，资源，系统服务等；
同样可以理解成“场景”：用户操作和系统交互这一过程就是一个场景，比如Activity之间的切换，服务的启动等都少不了Context。

然而以上这些都是我们从抽象角度去理解Context的作用，那么从Code代码来看Context到底是什么呢？Activity是一个Context，Application是一个Context
，Service也是一个Context.

   {% highlight java  %}
public abstract class Context {
..............................
 /** Return an AssetManager instance for your application's package. */
    public abstract AssetManager getAssets();

    /** Return a Resources instance for your application's package. */
    public abstract Resources getResources();

    /** Return PackageManager instance to find global package information. */
    public abstract PackageManager getPackageManager();

    /** Return a ContentResolver instance for your application's package. */
    public abstract ContentResolver getContentResolver();

...................
//获取系统服务
public abstract Object getSystemService(@ServiceName @NonNull String name);
//发送广播
public abstract void sendBroadcast(Intent intent);
//启动Activity
public abstract void startActivity(Intent intent);
//启动服务，绑定服务
public abstract ComponentName startService(Intent service);
public abstract boolean bindService(Intent service, @NonNull ServiceConnection conn,
            @BindServiceFlags int flags);

................
}

   {% endhighlight %}

<!-- more -->

从源码看Context就是一个抽象类，里面定义了各种抽象方法，包括获取系统资源，获取系统服务，发送广播，启动Activity,Service等。
所以从源码角度看Context就是抽象出一个App应用所有功能的集合，由于Context是一个纯的抽象类，
所以它的具体的方法实现是在其之类ContextImpl中实现了，稍后分析。我们平时在MainActivity中会这么给mContext = this赋值，
其言外之意就是当前Activity类就是Context，那说明Activity是Context的子类。通过Android Studio查看Context的子类图如下：

![](https://raw.githubusercontent.com/mxn21/mxn21.github.io/master/public/img/img65.png)

有图可知，Context的子类很多，我们主要分析以上红色矩形框内的即可。接下来就分析Android系统中Context的继承关系！

## Android系统中Context的继承关系

有上一节我们知道，Activity是一个Context，Service也是一个Context等等，那么这些类跟Context具体什么关系呢？接下来有一幅图Context继承关系图来说明：

![](https://raw.githubusercontent.com/mxn21/mxn21.github.io/master/public/img/img66.png)

Context类是一个抽象类，具体实现在ContextImpl类中；而ContextWrapper是Context的一个包装类，
其里面所有的方法实现都是调用其内部mBase变量的方法，而mBase就是ContextImpl对象，稍后分析。
然而ContextWrapper还有一个ContextThemeWrapper子类，该类中扩展了主题相关的方法。有继承关系图可以看出，
Application和Service是继承自ContextWrapper，而Activity是继承自ContextThemeWrapper，
Activity在启动的时候系统都会加载一个主题，也就是我们平时在AndroidManifest.xml文件里面写的android:theme="@style/AppTheme"属性.




