---
layout: post
author: mxn
titile:理解JVM
category: 技术博文
tag: android
---

当运行一个Java程序的同时，也就是运行了一个Java虚拟机实例。每个Java程序都运行于某个具体的Java虚拟机实现的实例上。

## Java虚拟机的生命周期

一个运行时的Java虚拟机实例的天职就是：负责运行一个Java程序。当启动一个Java程序时，一个虚拟机实例也就诞生了。当该程序关闭退出是，
这个虚拟机实例也就随之消亡。如果在同一个计算机上同时运行三个程序，将得到三个Java虚拟机实例。每个Java程序都运行于它自己的Java虚拟机实例中。

Java虚拟机实例通过调用某个初始类的main()方法来运行一个Java程序，此方法将作为该程序初始线程的启动，任何其他的线程都是由这个初始线程启动的。

在Java虚拟机内部有两种线程：守护线程与非守护线程。守护线程通常是由虚拟机自己使用的，比如执行垃圾收集任务的线程。但是，
Java程序也可以把他创建的任何线程标记为守护线程。而Java程序中的初始线程,就是开始于main()的那个，是非守护进程。只要还有非守护线程在运行，
那么这个Java程序也在继续运行（虚拟机仍然存活）。当该程序中所有的非守护线程都终止时，虚拟机实例将自动退出。假若安全管理器允许，
程序本身也能够通过调用Runtime类或者System类的exit()方法来退出。

## Java虚拟机体系结构

![](https://raw.githubusercontent.com/mxn21/mxn21.github.io/master/public/img/img105.jpg)

从上图可以看得出来，JVM中包含:

1. Class Loader 类加载器

所有的class文件必须被加载后才能在jvm中运行.

2.Runtime Data Areas 运行数据区

运行时数据区分为：method area（本地方法区）、heap（堆）、java stacks(Java 栈)、 pc registers(pc寄存器)、 native method
stacks(本地方法栈）.

下面来依次解释下上述内容:

* Method area（方法区）

在Java虚拟机中，关于被装载类型的信息存储在一个逻辑上被称为方法区的内存中。当虚拟机装载某个类型时，它使用类装载器定位相应的class文件，
然后读入这个class文件——一个线性二进制数据流。然后将它传输到虚拟机中。紧接着虚拟机提取其中的类型信息，并将这些信息存储到方法区。
该类型中的类（静态）变量同样也是存储在方法区中。

Java虚拟机在内部如何存储类型信息，这是由具体实现的设计者来决定的。比如，在class文件中，多字节总是以高位在前（即代表较大数的字节在前）的顺序储存。
但是这些数据被引入到方法区后，虚拟机可以以任何方式存储它。假设某个实现是运行在低位优先的处理器上，那么它很可能会把多字节以低位优先的
顺序存储到方法区中。

当虚拟机运行Java程序时，它会查找使用存储在方法区中的类型信息。设计者应当为类型信息的内部设计适当的数据结构，以尽可能在保持虚拟机小巧紧凑的同时加快程序的运行效率。
