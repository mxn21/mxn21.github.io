---
layout: post
author: mxn
titile: android分包原理
category: 技术博文
tag: android
---

如果App引用的库太多，方法数超过65536后无法编译。这是因为单个dex里面不能有超过65536个方法。为什么有最大的限制呢，
因为android编译的时候会把每一个类的方法id检索起来，存在一个链表结构里面。但是这个链表的长度是用一个short类型来保存的，
short占两个字节（保存-2的15次方到2的15次方-1，即-32768~32767），最大保存的数量就是65536。新版本的Android系统中修复了这个问题，
但是我们仍然需要对低版本的Android系统做兼容.

解决方法有如下几个：
1.精简方法数量,删除没用到的类、方法、第三方库。
2.复杂模块采用jni的方式实现，也可以对边缘模块采用本地插件化的方式。
3.分割Dex

本文只介绍最后一种方法。

dex文件拆成两个或多个，为此谷歌官方推出了multidex兼容包，配合AndroidStudio实现了一个APK包含多个dex的功能。

