---
layout: post
author: mxn
titile: java动态代理分析
category: 技术博文
tag: java
---
### 什么是代理

代理：代理模式是常用的Java 设计模式，它的特征是代理类与委托类有同样的接口，代理类主要负责为委托类预处理消息、过滤消息、把消息转发给委托类，以及事后处理消息等。

![](https://raw.githubusercontent.com/mxn21/mxn21.github.io/master/public/img/img6.jpg)

###  静态代理： 

比如要在输出“HelloWorld”前打印一个字符串“Welcome” 

A:先定义一个接口类 

{% highlight java %}
public interface HelloWorld {      
    public void print();      
//  public void say();      
} 
{% endhighlight  %}


 
 B: 定义一个该接口的实现类 
 
 {% highlight java %}
 public class HelloWorldImpl implements HelloWorld{      
     
    public void print(){      
        System.out.println("HelloWorld");      
    }      
//  public void say(){      
//      System.out.println("Say Hello!");      
//  }      
}  
 {% endhighlight  %}
 
C:定义一个静态代理类 
 {% highlight java %}
public class StaticProxy implements HelloWorld{      
     
    public HelloWorld helloWorld ;      
    public StaticProxy(HelloWorld helloWorld){      
        this.helloWorld = helloWorld;      
    }      
          
    public void print(){      
        System.out.println("Welcome");      
        //相当于回调      
        helloWorld.print();      
    }      
          
//  public void say(){      
//      //相当于回调      
//      helloWorld.say();      
//  }      
}      
 {% endhighlight  %}
 
 
 D: 一个测试类: 
 
  {% highlight java %}
  public class TestStaticProxy {      
     
    public static void main(String[] args){      
        HelloWorld helloWorld = new HelloWorldImpl();      
        StaticProxy staticProxy = new StaticProxy(helloWorld);      
        staticProxy.print();      
              
//      staticProxy.say();      
    }      
}    
   {% endhighlight  %}
  <!-- more -->
  
  
  可以看出静态代理类有一个很不爽的缺点：当如果接口加一个方法（把上面所有的代码的注释给去掉），所有的实现类和代理类里都需要做个实现。这就增加了代码的复杂度。动态代理就可以避免这个缺点。 
 
### 动态代理 

动态代理与普通的代理相比较，最大的好处是接口中声明的所有方法都被转移到一个集中的方法中处理（invoke），这样，在接口方法数量比较多的时候，我们可以进行灵活处理，而不需要像静态代理那样每一个方法进行中转。 

动态代理类只能代理接口，代理类都需要实现InvocationHandler类，实现invoke方法。该invoke方法就是调用被代理接口的所有方法时需要调用的，该invoke方法返回的值是被代理接口的一个实现类 



  
