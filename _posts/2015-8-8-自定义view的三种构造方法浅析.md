---
layout: post
author: mxn
titile: 自定义view的三种构造方法浅析
category: 技术博文
tag: android
---

View的子类，与View一样可以有三个constructor：

  {% highlight java  %}

   public void CustomView(Context context) {}

   public void CustomView(Context context, AttributeSet attrs) {}

   public void CustomView(Context context, AttributeSet attrs, int defStyle) {}

   {% endhighlight %}

为了方便，我们分别命名为C1,C2,C3。
C1是最简单的一个，如果你只打算用code动态创建一个view而不使用布局文件xml inflate，那么实现C1就可以了。

C2多了一个AttributeSet类型的参数，在通过布局文件xml创建一个view时，这个参数会将xml里设定的属性传递给构造函数。
如果你采用xml inflate的方法却没有在code里实现C2，那么运行时就会报错。但是由于编译能顺利通过，这个错误有时不太容易被发现。

C3多了一个defStyle的int参数，关于这个参数doc里是这样描述的：
The default style to apply to this view. If 0, no style will be applied (beyond what is included in the theme).
This may either be an attribute resource, whose value will be retrieved from the current theme, or an explicit
style resource.

那么C3到底什么时候被调用呢？答案是当你显式调用它的时候。通常是在C1或者C2里

  {% highlight java  %}
  public void CustomView(Context context, AttributeSet attrs) {
     this(context, attrs, resid);
  }

   {% endhighlight %}

用以上的方式将真正构造函数的实现转移到C3里，并由resid指定defStyle，作为默认style。

